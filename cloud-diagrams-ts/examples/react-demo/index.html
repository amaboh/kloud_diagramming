<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cloud Diagrams React Demo</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .demo-container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        margin: 0 0 10px 0;
        font-size: 2.5em;
        font-weight: 700;
      }

      .header p {
        margin: 0;
        font-size: 1.2em;
        opacity: 0.9;
      }

      .content {
        padding: 30px;
      }

      .controls {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
        align-items: center;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: #4f46e5;
        color: white;
      }

      .btn-primary:hover {
        background: #4338ca;
        transform: translateY(-2px);
      }

      .btn-secondary {
        background: #6b7280;
        color: white;
      }

      .btn-secondary:hover {
        background: #4b5563;
      }

      .btn-export {
        background: #059669;
        color: white;
      }

      .btn-export:hover {
        background: #047857;
      }

      .theme-toggle {
        background: #f59e0b;
        color: white;
      }

      .theme-toggle:hover {
        background: #d97706;
      }

      select {
        padding: 10px;
        border: 2px solid #e5e7eb;
        border-radius: 6px;
        font-size: 14px;
        background: white;
      }

      .diagram-container {
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        margin-bottom: 30px;
        overflow: hidden;
        background: #f9fafb;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: #f8fafc;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #4f46e5;
      }

      .stat-card h3 {
        margin: 0 0 8px 0;
        color: #374151;
        font-size: 0.9em;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .stat-card .value {
        font-size: 1.8em;
        font-weight: 700;
        color: #4f46e5;
      }

      .examples {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .example-card {
        background: #f8fafc;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .example-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
      }

      .example-card h3 {
        margin: 0 0 10px 0;
        color: #374151;
      }

      .example-card p {
        margin: 0;
        color: #6b7280;
        font-size: 0.9em;
      }

      .status {
        padding: 10px 20px;
        border-radius: 6px;
        margin-bottom: 20px;
        font-weight: 500;
      }

      .status.success {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #a7f3d0;
      }

      .status.error {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fca5a5;
      }

      .status.info {
        background: #dbeafe;
        color: #1e40af;
        border: 1px solid #93c5fd;
      }

      @media (max-width: 768px) {
        .controls {
          flex-direction: column;
          align-items: stretch;
        }

        .stats {
          grid-template-columns: 1fr;
        }

        .examples {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="demo-container">
      <div class="header">
        <h1>🌟 Cloud Diagrams React Demo</h1>
        <p>
          Interactive React components for multi-cloud architecture diagrams
        </p>
      </div>

      <div class="content">
        <div id="react-app">
          <!-- React app will be mounted here -->
          <div class="status info">
            <strong>Loading React Demo...</strong>
            <p>
              If this message persists, there may be an issue with the React
              build. Check the console for errors.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- React Demo App -->
    <script type="text/babel">
      const { useState, useEffect, useCallback } = React;
      const {
        DiagramRenderer,
        DiagramProvider,
        useDiagram,
        useTheme,
        useExport,
        CloudNode,
        DiagramGroup,
      } = CloudDiagramsReact;

      const { Diagram, Group, Edge } = CloudDiagramsCore;

      const { EC2, S3, RDS, VPC } = CloudDiagramsAWS;
      const { VirtualMachine, BlobStorage, SQLDatabase } = CloudDiagramsAzure;
      const { ComputeEngine, CloudStorage, CloudSQL } = CloudDiagramsGCP;

      // Example diagrams
      const createAWSExample = () => {
        const diagram = new Diagram('AWS 3-Tier Architecture');

        // Create VPC group
        const vpc = new Group('vpc-main', 'VPC (10.0.0.0/16)', {
          style: 'aws-vpc',
          metadata: { provider: 'aws', type: 'vpc' },
        });

        // Create nodes
        const webServer = new EC2('web-server', {
          instanceType: 't3.medium',
          region: 'us-west-2',
        });
        const database = new RDS('app-database', {
          engine: 'postgresql',
          multiAZ: true,
        });
        const storage = new S3('app-storage', {
          storageClass: 'standard',
        });

        // Add nodes to diagram
        diagram.addNode(webServer);
        diagram.addNode(database);
        diagram.addNode(storage);

        // Add group and assign nodes
        diagram.addGroup(vpc);
        vpc.addNode(webServer);
        vpc.addNode(database);

        // Create connections
        diagram.addEdge(
          new Edge('web-to-db', webServer.id, database.id, 'connects to')
        );
        diagram.addEdge(
          new Edge('web-to-storage', webServer.id, storage.id, 'stores files')
        );

        return diagram;
      };

      const createMultiCloudExample = () => {
        const diagram = new Diagram('Multi-Cloud Architecture');

        // AWS components
        const awsCompute = new EC2('aws-frontend');
        const awsStorage = new S3('aws-assets');

        // Azure components
        const azureCompute = new VirtualMachine('azure-backend');
        const azureStorage = new BlobStorage('azure-data');
        const azureDB = new SQLDatabase('azure-database');

        // GCP components
        const gcpCompute = new ComputeEngine('gcp-analytics');
        const gcpStorage = new CloudStorage('gcp-backup');
        const gcpDB = new CloudSQL('gcp-warehouse');

        // Add all nodes
        [
          awsCompute,
          awsStorage,
          azureCompute,
          azureStorage,
          azureDB,
          gcpCompute,
          gcpStorage,
          gcpDB,
        ].forEach((node) => diagram.addNode(node));

        // Create cross-cloud connections
        diagram.addEdge(
          new Edge('aws-to-azure', awsCompute.id, azureCompute.id, 'API calls')
        );
        diagram.addEdge(
          new Edge('azure-to-gcp', azureCompute.id, gcpCompute.id, 'data sync')
        );
        diagram.addEdge(
          new Edge('gcp-to-aws', gcpStorage.id, awsStorage.id, 'backup')
        );

        return diagram;
      };

      const createMicroservicesExample = () => {
        const diagram = new Diagram('Microservices with Service Mesh');

        // Create service groups
        const frontendGroup = new Group('frontend', 'Frontend Services');
        const backendGroup = new Group('backend', 'Backend Services');
        const dataGroup = new Group('data', 'Data Layer');

        // Frontend services
        const webApp = new EC2('web-app');
        const apiGateway = new EC2('api-gateway');

        // Backend services
        const userService = new EC2('user-service');
        const orderService = new EC2('order-service');
        const paymentService = new EC2('payment-service');

        // Data layer
        const userDB = new RDS('user-database');
        const orderDB = new RDS('order-database');
        const cache = new EC2('redis-cache');
        const fileStorage = new S3('file-storage');

        // Add nodes
        [
          webApp,
          apiGateway,
          userService,
          orderService,
          paymentService,
          userDB,
          orderDB,
          cache,
          fileStorage,
        ].forEach((node) => diagram.addNode(node));

        // Add groups
        [frontendGroup, backendGroup, dataGroup].forEach((group) =>
          diagram.addGroup(group)
        );

        // Assign nodes to groups
        frontendGroup.addNode(webApp);
        frontendGroup.addNode(apiGateway);
        backendGroup.addNode(userService);
        backendGroup.addNode(orderService);
        backendGroup.addNode(paymentService);
        dataGroup.addNode(userDB);
        dataGroup.addNode(orderDB);
        dataGroup.addNode(cache);
        dataGroup.addNode(fileStorage);

        // Create service mesh connections
        diagram.addEdge(new Edge('web-to-gateway', webApp.id, apiGateway.id));
        diagram.addEdge(
          new Edge('gateway-to-user', apiGateway.id, userService.id)
        );
        diagram.addEdge(
          new Edge('gateway-to-order', apiGateway.id, orderService.id)
        );
        diagram.addEdge(
          new Edge('order-to-payment', orderService.id, paymentService.id)
        );
        diagram.addEdge(new Edge('user-to-db', userService.id, userDB.id));
        diagram.addEdge(new Edge('order-to-db', orderService.id, orderDB.id));
        diagram.addEdge(
          new Edge('services-to-cache', userService.id, cache.id)
        );

        return diagram;
      };

      // Main Demo Component
      const CloudDiagramsDemo = () => {
        const [currentDiagram, setCurrentDiagram] = useState(() =>
          createAWSExample()
        );
        const [status, setStatus] = useState({ type: '', message: '' });
        const { theme, setTheme, toggleTheme, isDark, availableThemes } =
          useTheme();
        const { exportDiagram, downloadDiagram, isExporting } = useExport();

        const examples = [
          {
            name: 'AWS 3-Tier Architecture',
            description: 'Classic web application with VPC, EC2, RDS, and S3',
            diagram: createAWSExample,
          },
          {
            name: 'Multi-Cloud Setup',
            description: 'Hybrid architecture spanning AWS, Azure, and GCP',
            diagram: createMultiCloudExample,
          },
          {
            name: 'Microservices Architecture',
            description:
              'Service mesh with multiple microservices and data stores',
            diagram: createMicroservicesExample,
          },
        ];

        const handleExampleSelect = (exampleFn) => {
          setCurrentDiagram(exampleFn());
          setStatus({ type: 'info', message: 'Diagram updated successfully!' });
          setTimeout(() => setStatus({ type: '', message: '' }), 3000);
        };

        const handleExport = async (format) => {
          try {
            await downloadDiagram(currentDiagram, format, {
              filename: `${currentDiagram.title.toLowerCase().replace(/\s+/g, '-')}.${format}`,
              width: 1200,
              height: 800,
            });
            setStatus({
              type: 'success',
              message: `Diagram exported as ${format.toUpperCase()}!`,
            });
          } catch (error) {
            setStatus({
              type: 'error',
              message: `Export failed: ${error.message}`,
            });
          }
          setTimeout(() => setStatus({ type: '', message: '' }), 5000);
        };

        const handleNodeClick = (nodeId, node) => {
          setStatus({
            type: 'info',
            message: `Clicked on ${node.label} (${node.provider} ${node.service})`,
          });
          setTimeout(() => setStatus({ type: '', message: '' }), 3000);
        };

        const handleRenderComplete = () => {
          setStatus({
            type: 'success',
            message: 'Diagram rendered successfully!',
          });
          setTimeout(() => setStatus({ type: '', message: '' }), 2000);
        };

        const handleRenderError = (error) => {
          setStatus({
            type: 'error',
            message: `Render error: ${error.message}`,
          });
        };

        return (
          <div>
            {/* Status Messages */}
            {status.message && (
              <div className={`status ${status.type}`}>
                <strong>{status.message}</strong>
              </div>
            )}

            {/* Controls */}
            <div className="controls">
              <button className="btn theme-toggle" onClick={toggleTheme}>
                {isDark ? '☀️' : '🌙'} {isDark ? 'Light' : 'Dark'} Theme
              </button>

              <select
                value={typeof theme === 'string' ? theme : 'custom'}
                onChange={(e) => setTheme(e.target.value)}
              >
                {availableThemes.map((t) => (
                  <option key={t} value={t}>
                    {t.charAt(0).toUpperCase() + t.slice(1)}
                  </option>
                ))}
              </select>

              <button
                className="btn btn-export"
                onClick={() => handleExport('svg')}
                disabled={isExporting}
              >
                📁 Export SVG
              </button>

              <button
                className="btn btn-export"
                onClick={() => handleExport('png')}
                disabled={isExporting}
              >
                🖼️ Export PNG
              </button>
            </div>

            {/* Diagram Stats */}
            <div className="stats">
              <div className="stat-card">
                <h3>Nodes</h3>
                <div className="value">{currentDiagram.nodes.length}</div>
              </div>
              <div className="stat-card">
                <h3>Groups</h3>
                <div className="value">{currentDiagram.groups.length}</div>
              </div>
              <div className="stat-card">
                <h3>Connections</h3>
                <div className="value">{currentDiagram.edges.length}</div>
              </div>
              <div className="stat-card">
                <h3>Theme</h3>
                <div className="value">
                  {typeof theme === 'string' ? theme : 'custom'}
                </div>
              </div>
            </div>

            {/* Main Diagram */}
            <div className="diagram-container">
              <DiagramRenderer
                diagram={currentDiagram}
                theme={theme}
                width="100%"
                height="500px"
                onNodeClick={handleNodeClick}
                onRenderComplete={handleRenderComplete}
                onRenderError={handleRenderError}
                interactive={true}
                autoResize={true}
              />
            </div>

            {/* Example Selector */}
            <div className="examples">
              {examples.map((example, index) => (
                <div
                  key={index}
                  className="example-card"
                  onClick={() => handleExampleSelect(example.diagram)}
                >
                  <h3>{example.name}</h3>
                  <p>{example.description}</p>
                </div>
              ))}
            </div>
          </div>
        );
      };

      // App with Provider
      const App = () => {
        return (
          <DiagramProvider theme="default">
            <CloudDiagramsDemo />
          </DiagramProvider>
        );
      };

      // Mount the app
      ReactDOM.render(<App />, document.getElementById('react-app'));
    </script>

    <!-- React and required libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Cloud Diagrams Libraries (these would be built and served) -->
    <script>
      // Mock the cloud diagrams libraries for the demo
      // In a real implementation, these would be the actual built packages
      window.CloudDiagramsCore = {
        Diagram: class Diagram {
          constructor(title) {
            this.title = title;
            this.nodes = [];
            this.groups = [];
            this.edges = [];
          }
          addNode(node) {
            this.nodes.push(node);
          }
          addGroup(group) {
            this.groups.push(group);
          }
          addEdge(edge) {
            this.edges.push(edge);
          }
        },
        Group: class Group {
          constructor(id, label, metadata = {}) {
            this.id = id;
            this.label = label;
            this.metadata = metadata;
            this.nodes = [];
            this.subgroups = [];
          }
          addNode(node) {
            this.nodes.push(node);
          }
        },
        Edge: class Edge {
          constructor(id, from, to, label = '') {
            this.id = id;
            this.from = from;
            this.to = to;
            this.label = label;
          }
        },
      };

      // Mock service classes
      const createServiceClass = (provider, service, category) => {
        return class {
          constructor(label, options = {}) {
            this.id = `${provider}-${service}-${Date.now()}-${Math.random()}`;
            this.label = label;
            this.provider = provider;
            this.service = service;
            this.category = category;
            this.metadata = options;
          }
        };
      };

      window.CloudDiagramsAWS = {
        EC2: createServiceClass('aws', 'ec2', 'compute'),
        S3: createServiceClass('aws', 's3', 'storage'),
        RDS: createServiceClass('aws', 'rds', 'database'),
        VPC: createServiceClass('aws', 'vpc', 'network'),
      };

      window.CloudDiagramsAzure = {
        VirtualMachine: createServiceClass(
          'azure',
          'virtual-machine',
          'compute'
        ),
        BlobStorage: createServiceClass('azure', 'blob-storage', 'storage'),
        SQLDatabase: createServiceClass('azure', 'sql-database', 'database'),
      };

      window.CloudDiagramsGCP = {
        ComputeEngine: createServiceClass('gcp', 'compute-engine', 'compute'),
        CloudStorage: createServiceClass('gcp', 'cloud-storage', 'storage'),
        CloudSQL: createServiceClass('gcp', 'cloud-sql', 'database'),
      };

      // Mock React components and hooks
      window.CloudDiagramsReact = {
        DiagramRenderer: ({
          diagram,
          onNodeClick,
          onRenderComplete,
          ...props
        }) => {
          React.useEffect(() => {
            onRenderComplete?.();
          }, [diagram]);

          return React.createElement(
            'div',
            {
              style: {
                ...props.style,
                width: props.width,
                height: props.height,
                border: '2px solid #e5e7eb',
                borderRadius: '8px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                background: '#f9fafb',
                flexDirection: 'column',
                gap: '10px',
              },
              onClick: () =>
                onNodeClick?.('demo-node', {
                  label: 'Demo Node',
                  provider: 'aws',
                  service: 'ec2',
                }),
            },
            [
              React.createElement(
                'div',
                {
                  style: { fontSize: '24px', marginBottom: '10px' },
                },
                '🎨'
              ),
              React.createElement(
                'div',
                {
                  style: {
                    fontSize: '18px',
                    fontWeight: 'bold',
                    marginBottom: '5px',
                  },
                },
                diagram.title
              ),
              React.createElement(
                'div',
                {
                  style: { fontSize: '14px', color: '#666' },
                },
                `${diagram.nodes.length} nodes, ${diagram.groups.length} groups, ${diagram.edges.length} edges`
              ),
              React.createElement(
                'div',
                {
                  style: { fontSize: '12px', color: '#999', marginTop: '10px' },
                },
                'Click to simulate node interaction'
              ),
              React.createElement(
                'div',
                {
                  style: { fontSize: '11px', color: '#999' },
                },
                `Theme: ${typeof props.theme === 'string' ? props.theme : 'custom'}`
              ),
            ]
          );
        },

        DiagramProvider: ({ children }) => children,

        useDiagram: (initialDiagram) => ({
          diagram: initialDiagram,
          addNode: () => {},
          removeNode: () => {},
          render: async () => '<svg></svg>',
          isRendering: false,
        }),

        useTheme: (initial = 'default') => {
          const [theme, setTheme] = React.useState(initial);
          return {
            theme,
            setTheme,
            toggleTheme: () =>
              setTheme((t) => (t === 'light' ? 'dark' : 'light')),
            isDark: theme === 'dark',
            availableThemes: ['default', 'light', 'dark'],
          };
        },

        useExport: () => ({
          exportDiagram: async () => '<svg></svg>',
          downloadDiagram: async (diagram, format) => {
            // Simulate download
            console.log(`Downloading ${diagram.title} as ${format}`);
          },
          isExporting: false,
          exportError: null,
        }),
      };
    </script>
  </body>
</html>
