<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cloud Diagrams Viewer - localhost:3000</title>
    <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        color: white;
      }

      .header h1 {
        font-size: 3rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .controls {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
      }

      .controls label {
        font-weight: 600;
        color: #555;
      }

      .controls select,
      .controls button {
        padding: 8px 15px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .controls button {
        background: #667eea;
        color: white;
        border-color: #667eea;
        cursor: pointer;
        font-weight: 600;
      }

      .controls button:hover {
        background: #5a67d8;
        transform: translateY(-1px);
      }

      .diagram-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
        gap: 30px;
      }

      .diagram-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .diagram-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      }

      .diagram-card h3 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.4rem;
        border-bottom: 2px solid #667eea;
        padding-bottom: 8px;
      }

      .diagram-container {
        min-height: 400px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 15px;
        background: #f8fafc;
        overflow: auto;
      }

      .diagram-info {
        margin-top: 15px;
        padding: 12px;
        background: #f0f7ff;
        border-radius: 6px;
        border-left: 4px solid #667eea;
      }

      .diagram-info p {
        margin: 5px 0;
        font-size: 14px;
        color: #555;
      }

      .download-btn {
        margin-top: 10px;
        padding: 6px 12px;
        background: #48bb78;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }

      .download-btn:hover {
        background: #38a169;
      }

      .status {
        padding: 10px 20px;
        margin: 20px 0;
        border-radius: 6px;
        font-weight: 600;
      }

      .status.success {
        background: #c6f6d5;
        color: #22543d;
        border: 1px solid #9ae6b4;
      }

      .status.error {
        background: #fed7d7;
        color: #742a2a;
        border: 1px solid #feb2b2;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2rem;
        }

        .controls {
          flex-direction: column;
          align-items: stretch;
        }

        .diagram-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üèóÔ∏è Cloud Architecture Viewer</h1>
        <p>
          Interactive visualization of cloud diagrams powered by @cloud-diagrams
        </p>
      </div>

      <div class="controls">
        <label for="example-select">Choose Example:</label>
        <select id="example-select">
          <option value="basic">Basic AWS Architecture</option>
          <option value="3tier">3-Tier Web Application</option>
          <option value="microservices">Microservices with Azure</option>
          <option value="multicloud">Multi-Cloud Data Pipeline</option>
          <option value="custom">Custom Architecture</option>
        </select>

        <label for="theme-select">Theme:</label>
        <select id="theme-select">
          <option value="default">Default</option>
          <option value="dark">Dark</option>
          <option value="forest">Forest</option>
          <option value="base">Base</option>
        </select>

        <button onclick="generateDiagram()">üîÑ Regenerate</button>
        <button onclick="exportDiagram()">üì• Export SVG</button>
      </div>

      <div id="status"></div>

      <div class="diagram-grid">
        <div class="diagram-card">
          <h3 id="diagram-title">Basic AWS Architecture</h3>
          <div class="diagram-container">
            <div id="diagram-content"></div>
          </div>
          <div class="diagram-info" id="diagram-info">
            <p><strong>Nodes:</strong> <span id="node-count">0</span></p>
            <p>
              <strong>Connections:</strong> <span id="connection-count">0</span>
            </p>
            <p><strong>Provider:</strong> <span id="provider">AWS</span></p>
          </div>
        </div>

        <div class="diagram-card">
          <h3>Mermaid Source Code</h3>
          <div class="diagram-container">
            <pre
              id="mermaid-source"
              style="
                white-space: pre-wrap;
                font-family: 'Courier New', monospace;
                font-size: 12px;
                line-height: 1.4;
              "
            ></pre>
          </div>
          <button class="download-btn" onclick="copyToClipboard()">
            üìã Copy Code
          </button>
        </div>
      </div>
    </div>

    <script>
      // Initialize Mermaid
      mermaid.initialize({
        startOnLoad: true,
        theme: 'default',
        flowchart: {
          useMaxWidth: true,
          htmlLabels: true,
        },
        securityLevel: 'loose',
      });

      // Diagram definitions
      const diagrams = {
        basic: {
          title: 'Basic AWS Architecture',
          provider: 'AWS',
          nodes: 4,
          connections: 3,
          code: `flowchart TD
    subgraph vpc["Main VPC (10.0.0.0/16)"]
        alb["üîÑ Application Load Balancer"]
        web["üñ•Ô∏è Web Server<br/>t3.medium"]
        db["üóÑÔ∏è PostgreSQL Database<br/>db.t3.micro"]
    end
    s3["üì¶ Static Assets<br/>S3 Bucket"]
    
    alb -->|"HTTP traffic"| web
    web -.->|"SQL queries"| db
    web -->|"serve assets"| s3
    
    style vpc fill:#e8f4f8,stroke:#1f77b4,stroke-width:2px
    style alb fill:#ff9900,stroke:#ff6600,stroke-width:2px
    style web fill:#ff9900,stroke:#ff6600,stroke-width:2px
    style db fill:#3369e7,stroke:#1f4788,stroke-width:2px
    style s3 fill:#569a31,stroke:#3d6e26,stroke-width:2px`,
        },
        '3tier': {
          title: '3-Tier Web Application',
          provider: 'AWS',
          nodes: 7,
          connections: 6,
          code: `flowchart TD
    subgraph web["üåê Web Tier"]
        alb["üîÑ Application Load Balancer"]
        web1["üñ•Ô∏è Web Server 1"]
        web2["üñ•Ô∏è Web Server 2"]
    end
    
    subgraph app["‚öôÔ∏è Application Tier"]
        app1["üèóÔ∏è App Server 1"]
        app2["üèóÔ∏è App Server 2"]
    end
    
    subgraph data["üíæ Data Tier"]
        primary["üóÑÔ∏è Primary Database"]
        replica["üóÑÔ∏è Read Replica"]
    end
    
    alb --> web1
    alb --> web2
    web1 --> app1
    web2 --> app2
    app1 --> primary
    app2 --> replica
    primary -.->|"replication"| replica
    
    style web fill:#e8f4f8,stroke:#1f77b4
    style app fill:#fff2e8,stroke:#ff9900
    style data fill:#e8f8e8,stroke:#22c55e`,
        },
        microservices: {
          title: 'Microservices with Azure',
          provider: 'Azure',
          nodes: 8,
          connections: 7,
          code: `flowchart TD
    gateway["üö™ API Gateway"]
    
    subgraph services["üîß Microservices"]
        auth["üîê Auth Service<br/>Azure Functions"]
        user["üë§ User Service<br/>Container Instance"]
        order["üìã Order Service<br/>Container Instance"]
        payment["üí≥ Payment Service<br/>Azure Functions"]
    end
    
    subgraph data["üíæ Data Layer"]
        cosmos["üåü Cosmos DB"]
        sql["üóÑÔ∏è Azure SQL"]
        redis["‚ö° Redis Cache"]
    end
    
    gateway --> auth
    gateway --> user
    gateway --> order
    gateway --> payment
    
    auth --> cosmos
    user --> sql
    order --> sql
    payment --> redis
    
    style services fill:#e8f4f8,stroke:#0078d4
    style data fill:#e8f8e8,stroke:#22c55e`,
        },
        multicloud: {
          title: 'Multi-Cloud Data Pipeline',
          provider: 'Multi-Cloud',
          nodes: 6,
          connections: 5,
          code: `flowchart LR
    subgraph aws["‚òÅÔ∏è AWS"]
        s3["üì¶ S3 Data Lake"]
        lambda["‚ö° Lambda ETL"]
    end
    
    subgraph azure["‚òÅÔ∏è Azure"]
        blob["üì¶ Blob Storage"]
        func["‚ö° Azure Function"]
    end
    
    subgraph gcp["‚òÅÔ∏è Google Cloud"]
        storage["üì¶ Cloud Storage"]
        bigquery["üìä BigQuery"]
    end
    
    s3 --> lambda
    blob --> func
    lambda --> storage
    func --> storage
    storage --> bigquery
    
    style aws fill:#ff9900,stroke:#ff6600,color:#fff
    style azure fill:#0078d4,stroke:#005a9e,color:#fff
    style gcp fill:#4285f4,stroke:#1a73e8,color:#fff`,
        },
        custom: {
          title: 'Custom Architecture',
          provider: 'Custom',
          nodes: 3,
          connections: 2,
          code: `flowchart TD
    A["üñ•Ô∏è Your Custom Node"]
    B["üîÑ Processing Node"]
    C["üíæ Storage Node"]
    
    A --> B
    B --> C
    
    style A fill:#667eea,stroke:#5a67d8,color:#fff
    style B fill:#764ba2,stroke:#6b46c1,color:#fff
    style C fill:#48bb78,stroke:#38a169,color:#fff`,
        },
      };

      let currentDiagram = 'basic';
      let currentTheme = 'default';

      function showStatus(message, type = 'success') {
        const status = document.getElementById('status');
        status.className = `status ${type}`;
        status.textContent = message;
        setTimeout(() => {
          status.textContent = '';
          status.className = '';
        }, 3000);
      }

      async function generateDiagram() {
        try {
          const diagram = diagrams[currentDiagram];

          // Update theme
          mermaid.initialize({
            theme: currentTheme,
            flowchart: {
              useMaxWidth: true,
              htmlLabels: true,
            },
            securityLevel: 'loose',
          });

          // Update info
          document.getElementById('diagram-title').textContent = diagram.title;
          document.getElementById('node-count').textContent = diagram.nodes;
          document.getElementById('connection-count').textContent =
            diagram.connections;
          document.getElementById('provider').textContent = diagram.provider;
          document.getElementById('mermaid-source').textContent = diagram.code;

          // Clear previous diagram
          const container = document.getElementById('diagram-content');
          container.innerHTML = '';

          // Generate unique ID for this render
          const diagramId = 'diagram-' + Date.now();

          // Render new diagram
          const { svg } = await mermaid.render(diagramId, diagram.code);
          container.innerHTML = svg;

          // Add click handlers to SVG elements
          container.querySelectorAll('g.node').forEach((node) => {
            node.style.cursor = 'pointer';
            node.addEventListener('click', (e) => {
              const nodeText = node.textContent.trim();
              showStatus(`üñ±Ô∏è Clicked on: ${nodeText}`, 'success');
            });
          });

          showStatus('‚úÖ Diagram generated successfully!', 'success');
        } catch (error) {
          console.error('Error generating diagram:', error);
          showStatus('‚ùå Error generating diagram: ' + error.message, 'error');
        }
      }

      function exportDiagram() {
        try {
          const svg = document.querySelector('#diagram-content svg');
          if (!svg) {
            showStatus('‚ùå No diagram to export', 'error');
            return;
          }

          const svgData = new XMLSerializer().serializeToString(svg);
          const blob = new Blob([svgData], { type: 'image/svg+xml' });
          const url = URL.createObjectURL(blob);

          const a = document.createElement('a');
          a.href = url;
          a.download = `${currentDiagram}-architecture.svg`;
          a.click();

          URL.revokeObjectURL(url);
          showStatus('üì• Diagram exported successfully!', 'success');
        } catch (error) {
          showStatus('‚ùå Export failed: ' + error.message, 'error');
        }
      }

      function copyToClipboard() {
        const code = document.getElementById('mermaid-source').textContent;
        navigator.clipboard
          .writeText(code)
          .then(() => {
            showStatus('üìã Mermaid code copied to clipboard!', 'success');
          })
          .catch(() => {
            showStatus('‚ùå Failed to copy to clipboard', 'error');
          });
      }

      // Event listeners
      document
        .getElementById('example-select')
        .addEventListener('change', (e) => {
          currentDiagram = e.target.value;
          generateDiagram();
        });

      document
        .getElementById('theme-select')
        .addEventListener('change', (e) => {
          currentTheme = e.target.value;
          generateDiagram();
        });

      // Generate initial diagram
      generateDiagram();

      // Auto-refresh every 30 seconds for development
      // setInterval(generateDiagram, 30000);
    </script>
  </body>
</html>
